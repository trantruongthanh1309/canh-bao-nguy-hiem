<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Báº£ng Äiá»u Khiá»ƒn Admin</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  </head>

  <body>
    <div class="container">
      <h1>ğŸ›¡ï¸ Báº¢NG ÄIá»€U KHIá»‚N ADMIN ğŸ›¡ï¸</h1>

      <div id="map" style="height: 400px; margin: 20px 0"></div>

      <div class="alert-list">
        <h2>ğŸ“‹ Cáº£nh bÃ¡o nháº­n Ä‘Æ°á»£c:</h2>
        <ul></ul>
      </div>
    </div>

    <script>
      const map = L.map("map").setView([16.047079, 108.20623], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "Â© OpenStreetMap contributors",
      }).addTo(map);

      let markers = [];

      function fetchAlerts() {
        fetch("/api/alerts")
          .then((res) => res.json())
          .then((data) => {
            // Clear old markers
            markers.forEach((marker) => map.removeLayer(marker));
            markers = [];

            const list = document.querySelector(".alert-list ul");
            list.innerHTML = "";

            data.forEach((alert) => {
              const marker = L.marker([alert.lat, alert.lng])
                .addTo(map)
                .bindPopup(`â° ${alert.time}<br>ğŸ“ ${alert.lat}, ${alert.lng}`);
              markers.push(marker);

              const li = document.createElement("li");
              li.innerHTML = `â° ${alert.time} â€“ ğŸ“ ${alert.lat}, ${alert.lng}`;

              if (alert.audio) {
                li.innerHTML += `
    <br>
    <audio controls>
      <source src="${alert.audio}" type="audio/webm">
      TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ phÃ¡t Ã¢m thanh.
    </audio>
  `;
              }

              list.appendChild(li);
            });
          });
      }

      fetchAlerts();
      setInterval(fetchAlerts, 5000); // cáº­p nháº­t má»—i 5 giÃ¢y
    </script>
  </body>
</html>
